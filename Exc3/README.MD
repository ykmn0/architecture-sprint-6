Риски, связанные с планируемым ростом нагрузки:
- увеличение числа страховых компаний и запросов приведет к росту времени на агрегацию данных, что ухудшит время ответа;
- больше интеграций означает больше точек отказа и вероятных проблем при обращении к API страховых компаний;
- частота таймаутов и ошибок 5xx/4xx увеличится;
- зависимость от REST API и синхронных взаимодействий делает всю архитектуру менее устойчивой к сбоям;
- проблемы с ins-product-aggregator повлияют на все зависимые сервисы;
- текущая архитектура не поддерживает простое масштабирование без значительных доработок;
- разные интервалы обновления данных в core-app и ins-comp-settlement приведут к несогласованности данных;
- текущая архитектура затрудняет добавление новых типов интеграций или изменение модели обновления данных.

Для устранения рисков необходимо планируется переход на Event-Driven архитектуру, что позволит:
- снизить связанность между сервисами;
- обеспечить асинхронное обновление данных;
- уменьшить нагрузку на ins-product-aggregator и REST API страховых компаний;
- повысить общую устойчивость системы к сбоям и масштабируемость.

Изменения:
- добавлен брокер событий (Event Broker);
- ins-product-aggregator публикует события обновления продуктов;
- core-app и ins-comp-settlement подписываются на эти события и обновляют свои локальные данные;
- core-app публикует события о новых полисах вместо того, чтобы ins-comp-settlement опрашивал его по REST.

Рассмотрено применение Transactional Outbox для гарантированной доставки событий.

Transactional Outbox:
Для гарантированной доставки событий ins-product-aggregator и core-app могут использовать паттерн Transactional Outbox:
- при обновлении БД (productAggDB_r1 или coreAppDB_r1) запись об изменении попадает в outbox таблицу;
- отдельный процесс читает outbox и публикует события в eventBroker_r1.
Это гарантирует согласованность данных и сообщений.